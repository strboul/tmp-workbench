---
- name: Install Docker
  pacman:
    name:
      - community/docker
      - community/docker-compose
    state: present
  become: true

- name: Setup Docker
  block:
    - name: Create the docker group
      group:
        name: docker
        state: present

    - name: Add user to the docker group
      user:
        name: "{{ ansible_env.USER }}"
        group: docker

    # Follow the post-install steps here for the rest:
    # https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user
    #
    # reboot & reload is needed to have Docker ready.
    # check the daemon with: `systemctl status docker`
  become: true
